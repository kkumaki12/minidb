/*
Package buffer はデータベースのバッファプール層を提供する。

# 概要

バッファプールはディスク上のページをメモリにキャッシュする仕組み。
毎回ディスクからページを読むのは遅いため、頻繁にアクセスされる
ページをメモリ上に保持しておく。

	┌─────────────────────────────────────────────────┐
	│                  アプリケーション                  │
	└─────────────────────┬───────────────────────────┘
	                      │ FetchPage / CreatePage
	┌─────────────────────▼───────────────────────────┐
	│               BufferPoolManager                  │
	│  ┌─────────────────────────────────────────┐    │
	│  │            BufferPool (メモリ)           │    │
	│  │  ┌───────┬───────┬───────┬───────┐     │    │
	│  │  │Frame 0│Frame 1│Frame 2│  ...  │     │    │
	│  │  └───────┴───────┴───────┴───────┘     │    │
	│  └─────────────────────────────────────────┘    │
	└─────────────────────┬───────────────────────────┘
	                      │ ReadPageData / WritePageData
	┌─────────────────────▼───────────────────────────┐
	│               DiskManager (ディスク)             │
	└─────────────────────────────────────────────────┘

# 構成要素

Buffer: メモリ上にキャッシュされた1ページ分のデータ
  - PageID: どのページのデータか
  - Page: ページデータ本体（4KBのバイト配列）
  - IsDirty: メモリ上で変更されたか（書き戻しが必要か）

Frame: バッファプール内の1スロット
  - Buffer: キャッシュされたページ
  - UsageCount: 最近どれだけ使われたか（置換アルゴリズム用）

BufferPool: Frameの配列。サイズは固定。

BufferPoolManager: バッファプールとディスクマネージャを統括。

# ページ置換アルゴリズム（Clock-sweep）

バッファプールが満杯のとき、新しいページを読み込むには
既存のページを追い出す（evict）必要がある。

Clock-sweepは時計の針のようにFrameを順番に見ていき：
  1. UsageCount == 0 なら、そのFrameを置換対象に選ぶ
  2. UsageCount > 0 なら、UsageCountを1減らして次へ進む
  3. 参照中（pinされている）のFrameはスキップ

これにより、最近使われていないページが優先的に追い出される。

	        nextVictimID
	             ↓
	┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐
	│ 0 │→│ 1 │→│ 2 │→│ 3 │→│ 4 │→ (循環)
	└───┘ └───┘ └───┘ └───┘ └───┘

# Dirty Page（ダーティページ）

メモリ上で変更されたがディスクに書き戻されていないページ。
ページを追い出す前に、dirtyならディスクに書き戻す必要がある。

# 使用例

	// バッファプールマネージャを作成
	disk, _ := disk.Open("data.db")
	pool := buffer.NewBufferPool(10)  // 10フレーム分
	mgr := buffer.NewBufferPoolManager(disk, pool)

	// ページを取得（キャッシュになければディスクから読む）
	buf, _ := mgr.FetchPage(disk.PageID(0))

	// 新しいページを作成
	newBuf, _ := mgr.CreatePage()

	// 全ての変更をディスクに書き戻す
	mgr.Flush()
*/
package buffer
